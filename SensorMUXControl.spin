{  Project: EE-18 Assignment  Platform: Parallax Project USB Board  Revision: 1.1  Author: Teo Xin Yi  Date: 5th Mar 2022  Log:        Date: Desc        5/3/2022: Re-wiring of all sensors        16/3/2022: Integration}CON  _clkmode = xtal1 + pll16x  _xinfreq = 5_000_000  _ConClkFreq = ((_clkmode - xtal1) >> 6) * _xinfreq  _Ms_001 = _ConClkFreq / 1_000  tcaSCL = 8  tcaSDA = 9  tcaRST = 10  tcaAdd = $70  ' ToF GPIO0  ToF1RST = 6  ToF2RST = 7  ' Sensors Add  ToFAdd        = $29  UltraAdd      = $57  _maxI2CDevice = 5             ' 0 to 7VAR  ' Global Variable  long cogIDNum, cogStack[128]OBJ  ' TCA9548Av2 - I2C conncection to ToF & Ultrasonic  TCA           : "TCA9548Av2.spin"                                             ' I2C 1-to-8 Switch  ' Debugging  'DBG           : "FullDuplexSerial.spin"  ' Create a hardware definition filePUB Start(tofMainMem, ultraMainMem){{ Launch sensors units into new core }}  Stop  cogIDNum := cognew(sensorCore(tofMainMem, ultraMainMem), @cogStack) + 1  return cogIDNumPUB Stop                                                                    'To stop the code in the core/cog and release the core/cog  if cogIDNum    cogstop (~cogIDNum - 1)  returnPUB sensorCore(tofMainMem, ultraMainMem) | i{{ Main code running sensors retrieving & updating main memory }}  ' Init TCA9548A  TCA.PInit2  Pause(100)  ' Init ToF  TCA.PSelect(0, 0)  tofInit(0)  Pause(500)  TCA.PSelect(1, 0)  tofInit(1)  Pause(500)  repeat    ' ToF 1 - Front    TCA.PSelect(0, 0)    long[tofMainMem][0] := TCA.GetSingleRange(ToFAdd)    Pause(1)    ' ToF 2 - Back    TCA.PSelect(1, 0)    long[tofMainMem][1] := TCA.GetSingleRange(ToFAdd)    Pause(1)    ' Ultrasonic 1 - Front    TCA.PSelect(2, 0)    TCA.PWriteByte(2, UltraAdd, $01)                                            ' <-- Trigger Sensor    Pause(50)    long[ultraMainMem][0] := TCA.readHCSR04(2, UltraAdd)*100/254    Pause(1)    TCA.resetHCSR04(2, UltraAdd)    ' Ultrasonic 2 - Back    TCA.PSelect(3, 0)    TCA.PWriteByte(3, UltraAdd, $01)                                            ' <-- Trigger Sensor    Pause(50)    long[ultraMainMem][1] := TCA.readHCSR04(3, UltraAdd)*100/254    Pause(1)    TCA.resetHCSR04(3, UltraAdd)    ' Ultrasonic 3 - Left    TCA.PSelect(4, 0)    TCA.PWriteByte(4, UltraAdd, $01)                                            ' <-- Trigger Sensor    Pause(50)    long[ultraMainMem][2] := TCA.readHCSR04(4, UltraAdd)*100/254    Pause(1)    TCA.resetHCSR04(4, UltraAdd)    ' Ultrasonic 4 - Right    TCA.PSelect(5, 0)    TCA.PWriteByte(5, UltraAdd, $01)                                            ' <-- Trigger Sensor    Pause(50)    long[ultraMainMem][3] := TCA.readHCSR04(5, UltraAdd)*100/254    Pause(1)    TCA.resetHCSR04(5, UltraAdd)PRI tofInit(i)  case i    0:      TCA.initVL6180X(ToF1RST)      TCA.ChipReset(1, ToF1RST)      Pause(100)      TCA.FreshReset(ToFAdd)      TCA.MandatoryLoad(ToFAdd)      TCA.RecommendedLoad(ToFAdd)      TCA.FreshReset(ToFAdd)    1:      TCA.initVL6180X(ToF2RST)      TCA.ChipReset(1, ToF2RST)      Pause(100)      TCA.FreshReset(ToFAdd)      TCA.MandatoryLoad(ToFAdd)      TCA.RecommendedLoad(ToFAdd)      TCA.FreshReset(ToFAdd)PRI Pause(ms) | t  t := cnt - 1000  repeat (ms #> 0)    waitcnt(t += _Ms_001)  return